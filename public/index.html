<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Ed Alegrid">
    <title>Node-M2M Â· Demo v1.0</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

  </head>
  <body>

  <!-- page content -->
  <main>
    <h1 class="visually-hidden">Headers examples</h1>

    <div class="container">
      <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
          <span class="fs-4">Node-M2M Web Application Demo Using A Browser Client</span>
        </a>
      </header>
    </div>
    <div class="container">
      <div class="row justify-content-evenly">

      <div class="col-6">
        <div class="fs-5">Basic GPIO Remote Control Using A Raspberry Pi</div> 
        <div class="card mt-3" style="width:500px">
          <div class="card-body">
            <h6 class="card-title">Device Actuator Remote Control</h6>
            <p class="card-text">Switch on/off device 100 and 200 gpio output pin 33 and 35.</p>
            <div class="row justify-content-start">
              <div class="col-6">
                <a id="deviceOn" style="width:100px;" class="btn btn-primary" role="button" >ON</a>
                <a id="deviceOff" style="width:100px;" class="btn btn-primary" role="button" >OFF</a>
              </div>
              <div class="col-4 align-self-start">
                <div class="border text-center" id="msg1" style="height:38px;padding:7px;"></div>    
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="card" style="width:500px">
          <div class="card-body">
            <h6 class="card-title">Device Actuator Remote Control (toggle button)</h6>
            <p class="card-text">Switch on/off device 100 gpio output pin 33.</p>
            <div class="row justify-content-start">
              <div class="col-6">
                <a id="deviceToggle" style="width:200px;" class="btn btn-primary" role="button" >ON/OFF</a>
              </div>
              <div class="col-4 align-self-start">
                <div class="border text-center" id="msg2" style="height:38px;padding:7px;"></div>    
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="card" style="width:500px">
          <div class="card-body">
            <h6 class="card-title">Device Actuator Remote Control (toggle switch)</h6>
            <p class="card-text">Switch on/off device 200 gpio output pin 33 and 35.</p>
            <div class="row justify-content-start">
              <div class="col-1"></div>
              <div class="col-4">
                <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox" role="switch" id="device-control1" >
                  <label class="form-check-label" for="device-control1"> pin 33</label>
                </div>
                <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox" role="switch" id="device-control2" checked>
                  <label class="form-check-label" for="device-control2"> pin 35</label>
                </div>
              </div>
              <div class="col-4 align-self-start">
                <div class="border text-center" id="msg3" style="height:30px;padding:0px;"></div>
                <div class="border text-center" id="msg4" style="height:30px;padding:0px;"></div>       
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="card" style="width:500px">
          <div class="card-body">
            <h6 class="card-title">Get the current state of Device Input</h6>
            <p class="card-text">Get current state of device 100 gpio input pin 11. Push down the sw connected on pin 11 and click the button. Release the sw and click the button again.</p>
            <div class="row justify-content-start">
              <div class="col-6">
                <a id="get-state" style="width:200px;" class="btn btn-primary" role="button" >Get state</a>
              </div>
              <div class="col-4 align-self-start">
                <div class="border text-center" id="msg5" style="height:38px;padding:7px;"></div>    
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="card" style="width:500px">
          <div class="card-body">
            <h6 class="card-title">Watch the state of Device Input</h6>
            <p class="card-text">Watch state of device 100 gpio input pin 11. Push and release the sw connected on pin 11.</p>
            <div class="row justify-content-start">
              <div class="col-6">
                <a id="watch-state" style="width:200px;" class="btn btn-primary" role="button" >Watch state</a>
              </div>
              <div class="col-4 align-self-start">
                <div class="border text-center" id="msg6" style="height:38px;padding:7px;"></div>    
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="card" style="width:500px">
          <div class="card-body">
            <h6 class="card-title">Unwatch the state of Device Input</h6>
            <p class="card-text">Unwatch state of device 100 gpio input pin 11.</p>
            <div class="row justify-content-start">
              <div class="col-6">
                <a id="unwatch-state" style="width:200px;" class="btn btn-primary" role="button" >Unwatch state</a>
              </div>
              <div class="col-4 align-self-start">
                <div class="border text-center" id="msg7" style="height:38px;padding:7px;"></div>    
              </div>
            </div>
          </div>
        </div>
      </div><!-- class="col-6" -->
      <div class="col-6">
        <div class="fs-5">Capturing and Sending Data To A Remote Device</div> 
        <div class="card mt-3" style="width:500px">
          <div class="card-body">
            <h6 class="card-title">Capture Data from a Device</h6>
            <p class="card-text">Capture data from device 100 using <i>get-data</i> channel.</p>
            <div class="row justify-content-start">
              <div class="col-6">
                <a id="get-data" style="width:200px;" class="btn btn-primary" role="button" >Capture data</a>
              </div>
              <div class="col-4 align-self-start">
                <div class="border text-center" id="msg8" style="height:38px;padding:7px;"></div>    
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="card mt-0" style="width:500px">
          <div class="card-body">
            <h6 class="card-title">Send Data to a Device</h6>
            <p class="card-text">Send data to device 100 using <i>send-data</i> channel.</p>
            <div class="row justify-content-start">
              <div class="col-6">
                <form class="row g-3">
                  <div class="col-auto">
                    <label for="input-value" class="visually-hidden">Enter data</label>
                    <input id="input-value" type="text" class="form-control"  placeholder="Enter data">
                  </div>
                  <div class="col-auto">
                    <button id="send-data" style="width:200px;" type="button" class="btn btn-primary mb-0">Send data</button>
                  </div>
                </form>
              </div>
              <div class="col-4 align-self-start">
                <div class="border text-center" id="msg9" style="height:38px;padding:7px;"></div>    
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="card" style="width:500px">
          <div class="card-body">
            <h6 class="card-title">Watch Data from a Device</h6>
            <p class="card-text">Watch <i>random-number</i> channel data from device 200.</p>
            <div class="row justify-content-start">
              <div class="col-6">
                <a id="watch-data" style="width:200px;" class="btn btn-primary" role="button" >Watch data</a>
              </div>
              <div class="col-4 align-self-start">
                <div class="border text-center" id="msg10" style="height:38px;padding:7px;"></div>    
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="card" style="width:500px">
          <div class="card-body">
            <h6 class="card-title">Unwatch Data from a Device</h6>
            <p class="card-text">Unwatch <i>random-number</i> channel data from device 200.</p>
            <div class="row justify-content-start">
              <div class="col-6">
                <a id="unwatch-data" style="width:200px;" class="btn btn-primary" role="button" >Unwatch data</a>
              </div>
              <div class="col-4 align-self-start">
                <div class="border text-center" id="msg11" style="height:38px;padding:7px;"></div>    
              </div>
            </div>
          </div>
        </div>
      </div><!-- class="col-6" -->

      </div><!-- row -->
    </div><!-- container-->

  </main>
   
  <script src="/javascripts/node-m2m.min.js"></script>

  <script>

  // use your actual token   
  var tkn = 'fc7754138116139a6ad9a4234e71de810a1212087fa9e7fbfda745039f52616fc5';
  var toggleSwitch = true; 

  var client = new NodeM2M.Client(); 

  client.connect(tkn, () => {

  document.getElementById("deviceOn").addEventListener('click', {
    handleEvent: event => deviceOn('msg1')
  });

  document.getElementById("deviceOff").addEventListener('click', {
    handleEvent: event => deviceOff('msg1')
  });

  if(document.getElementById("deviceToggle")){
    document.getElementById("deviceToggle").onclick = deviceToggle;
  }

  document.getElementById("device-control1").addEventListener('click', {
    handleEvent: event => deviceControl(1) 
  });

  document.getElementById("device-control2").addEventListener('click', {
    handleEvent: event => deviceControl(2)
  });

  document.getElementById("device-control1").addEventListener('click', {
    handleEvent: event => deviceControl(1) 
  });

  document.getElementById("device-control2").addEventListener('click', {
    handleEvent: event => deviceControl(2)
  });

  // turn off device 200 pin 33 on page loading 
  if(document.getElementById("device-control1")){
    setTimeout(() => {
      deviceControl(1);
    }, 100);
  }

  // turn on device 200 pin 35 on page loading 
  if(document.getElementById("device-control2")){
    setTimeout(() => {
      deviceControl(2);
    }, 1000);
  }

  if(document.getElementById("get-state")){
    document.getElementById("get-state").onclick = getState;
  }

  if(document.getElementById("watch-state")){
    document.getElementById("watch-state").onclick = watchState;
  }

  if(document.getElementById("unwatch-state")){
    document.getElementById("unwatch-state").onclick = unwatchState;
  }

  if(document.getElementById("get-data")){
    document.getElementById("get-data").onclick = getData;
  }

  if(document.getElementById("send-data")){
    document.getElementById("send-data").onclick = sendData;
  }

  if(document.getElementById("watch-data")){
    document.getElementById("watch-data").onclick = watchData;
  }

  if(document.getElementById("unwatch-data")){
    document.getElementById("unwatch-data").onclick = unwatchData;
  }

  function deviceOn(msg){
    console.log('deviceOn');
    client.output({id:100, pin:33}).on();
    client.output({id:200, pin:33}).on();
    client.output({id:100, pin:35}).on();
    client.output({id:200, pin:35}).on();
    document.getElementById(msg).innerHTML = 'on' 
  }

  function deviceOff(msg){
    console.log('deviceOff');
    client.output({id:100, pin:33}).off();
    client.output({id:200, pin:33}).off();
    client.output({id:100, pin:35}).off();
    client.output({id:200, pin:35}).off();
    document.getElementById(msg).innerHTML = 'off' 
  }
  
  function deviceToggle(){
    console.log('deviceToggle');
    if(toggleSwitch){
      deviceOn('msg2');
      toggleSwitch = false;
    }
    else{
      deviceOff('msg2');
      toggleSwitch = true;
    }
  }

  function deviceControl(sel){
    console.log('deviceControl');
    var id = 200, pin = null, msg = null, status = null;

    if(sel === 1){
      status = document.getElementById("device-control1").checked;
      pin = 33;
      msg = 'msg3';
    }
    else{
      status = document.getElementById("device-control2").checked;
      pin = 35;
      msg = 'msg4';
    }

    if(status){
      client.output({id:id, pin:pin}).on((state) => {
        document.getElementById(msg).innerHTML = state;
      });
    }
    else{
      client.output({id:id, pin:pin}).off((state) => {
        document.getElementById(msg).innerHTML = state;
      });
    }
  }

  function getState(){
    console.log('getState');
    client.input({id:100, pin:11}).getState((state) => {
      document.getElementById('msg5').innerHTML = state;  
    });
  }

  function watchState(){
    console.log('watchState');
    client.input({id:100, pin:11}).watch((state) => {
      document.getElementById('msg6').innerHTML = state;  
    });
  }

  function unwatchState(){
    console.log('unwatchState');
    client.input({id:100, pin:11}).unwatch((state) => {
      document.getElementById('msg7').innerHTML = state;  
    });
  }

  function getData(){
    console.log('getData');
    client.getData({id:100, channel:'get-data'}, (data) => {
      document.getElementById('msg8').innerHTML = data;  
    });
  }

  function sendData(){
    console.log('sendData');
    var inputData = document.getElementById("input-value").value;
    client.sendData({id:100, channel:'send-data', payload:inputData}, (data) => {
      document.getElementById('msg9').innerHTML = data;  
    });
  }

  function watchData(){
    console.log('watchData');
    client.watch({id:200, channel:'random-number'}, (data) => {
      document.getElementById('msg10').innerHTML = data;  
    });
  }

  function unwatchData(){
    console.log('unwatchData');
    client.unwatch({id:200, channel:'random-number'}, (data) => {
      document.getElementById('msg11').innerHTML = data;  
    });
  }
    
  watchState();
  watchData();
      
  });  
  
  </script>
  <br>
  <footer class="footer mt-auto py-3 bg-light">
    <div class="container">
      <span class="text-muted">Node-M2M 2021</span>
    </div>
  </footer>

  </body>
</html>
